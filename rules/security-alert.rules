
val String LOGGER_NAME = "SecurityAlertRules"

/**
 * A value that indicates a LED indicator is off.
 */
val KEYPAD_LED_OFF = 0

var sentAlarmAlert = false

rule "Alert when security system is in alarm"
when
  Item PARTITION1_IN_ALARM changed from OFF to ON
then
  sentAlarmAlert = false;

  var subject = "Security system is in alarm"
  if (KEYPAD_FIRE_LED.state != KEYPAD_LED_OFF) {
    subject += ": FIRE"
  }

  AlertSender.postUpdate("{\"subject\":\"" + subject + "\"}")
  sentAlarmAlert = true
end

rule "Alert when security system is no longer in alarm"
when
  Item PARTITION1_IN_ALARM changed from ON to OFF
then
  if (sentAlarmAlert) {
    sentAlarmAlert = false

    val subject = "Security system is NO LONGER in alarm"
    AlertSender.postUpdate("{\"subject\":\"" + subject + "\"}")
  }
end
